{% extends "base.html" %}

{% block title %}Prediction Dashboard - Enhanced Image Classifier{% endblock %}

{% block head %}
<style>
    .prediction-image {
        max-width: 100%;
        max-height: 400px;
        object-fit: contain;
        border-radius: 12px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }
    
    .confidence-bar {
        height: 20px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        overflow: hidden;
        position: relative;
    }
    
    .confidence-fill {
        height: 100%;
        border-radius: 10px;
        transition: width 1s ease-out;
        background: linear-gradient(45deg, var(--bs-primary), #00b894);
        position: relative;
    }
    
    .confidence-fill.high { background: linear-gradient(45deg, var(--bs-success), #40c057); }
    .confidence-fill.medium { background: linear-gradient(45deg, var(--bs-warning), #fcc419); }
    .confidence-fill.low { background: linear-gradient(45deg, var(--bs-danger), #f03e3e); }
    
    .model-prediction-card {
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .model-prediction-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
    }
    
    .model-prediction-card.best-prediction {
        border: 2px solid var(--bs-success);
        background: linear-gradient(135deg, rgba(81, 207, 102, 0.1) 0%, rgba(64, 192, 87, 0.05) 100%);
    }
    
    .ensemble-card {
        background: linear-gradient(135deg, rgba(0, 212, 170, 0.1) 0%, rgba(0, 184, 148, 0.1) 100%);
        border: 2px solid var(--bs-primary);
    }
    
    .upload-zone {
        border: 3px dashed var(--border-color);
        border-radius: 12px;
        padding: 3rem 2rem;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
        background: rgba(0, 0, 0, 0.1);
    }
    
    .upload-zone:hover, .upload-zone.dragover {
        border-color: var(--bs-primary);
        background: rgba(0, 212, 170, 0.05);
        transform: scale(1.02);
    }
    
    .probability-bar {
        height: 6px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 3px;
        overflow: hidden;
        margin-top: 4px;
    }
    
    .probability-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--bs-info), var(--bs-primary));
        border-radius: 3px;
        transition: width 0.8s ease-out;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="text-center">
                <h1 class="display-4 fw-bold text-primary mb-3">
                    <i class="bi bi-speedometer2 me-3"></i>Multi-Model Prediction Dashboard
                </h1>
                <p class="lead text-muted">
                    Upload an image to see predictions from all trained models
                </p>
            </div>
        </div>
    </div>

    <!-- Model Status Overview -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-dark border-secondary">
                <div class="card-header bg-transparent border-secondary">
                    <h5 class="mb-0">
                        <i class="bi bi-cpu me-2 text-info"></i>Model Status Overview
                    </h5>
                </div>
                <div class="card-body">
                    <div id="modelStatusOverview" class="row">
                        <div class="col-12 text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading model status...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Upload Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-dark border-secondary">
                <div class="card-header bg-transparent border-secondary">
                    <h5 class="mb-0">
                        <i class="bi bi-cloud-upload me-2 text-primary"></i>Upload Image for Prediction
                    </h5>
                </div>
                <div class="card-body">
                    <div class="upload-zone" id="uploadZone" onclick="document.getElementById('imageInput').click()">
                        <input type="file" id="imageInput" accept="image/*" style="display: none;" onchange="handleImageUpload(this)">
                        <div id="uploadContent">
                            <i class="bi bi-cloud-upload fs-1 text-primary mb-3"></i>
                            <h5>Click to upload an image</h5>
                            <p class="text-muted">Or drag and drop an image here</p>
                            <small class="text-muted">Supports: JPG, PNG, GIF, BMP (Max: 16MB)</small>
                        </div>
                    </div>
                    
                    <div id="imagePreviewSection" class="mt-4 d-none">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-muted mb-3">Selected Image:</h6>
                                <div class="text-center">
                                    <img id="previewImage" class="prediction-image" alt="Preview">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-muted mb-3">Image Details:</h6>
                                <div id="imageDetails" class="card bg-dark border-secondary">
                                    <div class="card-body">
                                        <!-- Image details will be populated here -->
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <button class="btn btn-primary me-2" onclick="predictImage()">
                                        <i class="bi bi-play-circle me-1"></i>Predict with All Models
                                    </button>
                                    <button class="btn btn-outline-secondary" onclick="clearImage()">
                                        <i class="bi bi-x-circle me-1"></i>Clear
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Prediction Results Section -->
    <div id="resultsSection" class="d-none">
        <!-- Ensemble Result -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card ensemble-card">
                    <div class="card-header bg-transparent">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="bi bi-bullseye me-2"></i>Ensemble Prediction
                            </h5>
                            <span class="badge bg-primary fs-6">Combined Result</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="ensembleResult" class="row">
                            <!-- Ensemble content will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Individual Model Results -->
        <div class="row mb-4">
            <div class="col-12">
                <h4 class="text-muted mb-3">
                    <i class="bi bi-grid-3x3-gap me-2"></i>Individual Model Predictions
                </h4>
            </div>
        </div>
        
        <div id="individualResults" class="row g-4">
            <!-- Individual model results will be populated here -->
        </div>

        <!-- Confidence Analysis -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card bg-dark border-secondary">
                    <div class="card-header bg-transparent border-secondary">
                        <h5 class="mb-0">
                            <i class="bi bi-graph-up me-2 text-warning"></i>Prediction Analysis
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="confidenceAnalysis" class="row">
                            <!-- Analysis content will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Class Probabilities -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card bg-dark border-secondary">
                    <div class="card-header bg-transparent border-secondary">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="bi bi-bar-chart me-2 text-info"></i>Detailed Class Probabilities
                            </h5>
                            <button class="btn btn-outline-info btn-sm" onclick="toggleProbabilityView()">
                                <i class="bi bi-arrow-repeat me-1"></i>Toggle View
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="detailedProbabilities">
                            <!-- Detailed probabilities will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Prediction Loading Modal -->
<div class="modal fade" id="predictionModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center py-5">
                <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;" role="status">
                    <span class="visually-hidden">Processing...</span>
                </div>
                <h5 class="mb-2">Processing Image</h5>
                <p class="text-muted mb-0">Running predictions with all available models...</p>
                <div class="mt-3">
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" 
                             role="progressbar" style="width: 100%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Image Details Modal -->
<div class="modal fade" id="imageDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-info-circle me-2"></i>Prediction Details
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="detailedModalContent">
                    <!-- Detailed content will be populated here -->
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}